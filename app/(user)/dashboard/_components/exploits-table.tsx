import { useState, useEffect } from 'react';
import axiosInstance from '@/app/axios/instance';

export function ExploitTable() {
  const [services, setServices] = useState<any[]>([]); // State to hold services

  useEffect(() => {
    const fetchServices = async () => {
      try {
        const response = await axiosInstance.get('/user/services'); // Fetch data from the server
        setServices(response.data.services); // Update state with API response
      } catch (error) {
        console.error('Error fetching services:', error); // Log errors
      }
    };

    fetchServices();
  }, []); // Empty dependency array ensures it runs once on mount

  const formatDate = (isoDate) => {
    const date = new Date(isoDate);
    const day = String(date.getUTCDate()).padStart(2, "0");
    const month = String(date.getUTCMonth() + 1).padStart(2, "0"); // Месяцы начинаются с 0
    const year = date.getUTCFullYear();
    return `${day}.${month}.${year}`;
  };

  return (
    <div>
      {services.length > 0 ? (
        services.map((service, index) => (
          <div className="flex items-center px-2 py-2 border-b" key={index}>
            <img src={"https://www.google.com/s2/favicons?sz=64&domain_url=" + service.domain} className='w-10 rounded-full'></img>
            <div className="ml-4 space-y-1">
              <a className="text-sm font-medium leading-none" target="_blank" href={"https://" + service.domain}>{service.domain}</a>
              <p className="text-sm text-muted-foreground">{service.ip}</p>
            </div>
            <div className="ml-auto font-medium">{formatDate(service.createdAt)}</div>
          </div>
        ))
      ) : (
        <p className="text-center text-muted-foreground">Сервисов пока нет</p>
      )}
    </div>
  );
}
